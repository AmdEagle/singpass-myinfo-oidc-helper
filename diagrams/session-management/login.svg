<svg xmlns="http://www.w3.org/2000/svg" width="2134.671875px" height="977.40625px" class="sequence simple"><desc>Login</desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"/></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.92,16 0,13.7 5.76,8 0,2.286 1.92,0 9.6,8 z"/></marker></defs><g class="title"><rect x="10" y="10" width="58" height="27.5" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="15" y="29.15625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="15">Login</tspan></text></g><g class="actor"><rect x="10" y="47.5" width="87.203125" height="37.5" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="20" y="71.65625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="20">Browser</tspan></text></g><g class="actor"><rect x="10" y="919.90625" width="87.203125" height="37.5" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="20" y="944.0625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="20">Browser</tspan></text></g><line x1="53.6015625" x2="53.6015625" y1="85" y2="919.90625" stroke="#000000" fill="none" style="stroke-width: 2;"/><g class="actor"><rect x="962.5390625" y="47.5" width="144.8125" height="37.5" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="972.5390625" y="71.65625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="972.5390625">Relying Party</tspan></text></g><g class="actor"><rect x="962.5390625" y="919.90625" width="144.8125" height="37.5" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="972.5390625" y="944.0625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="972.5390625">Relying Party</tspan></text></g><line x1="1034.9453125" x2="1034.9453125" y1="85" y2="919.90625" stroke="#000000" fill="none" style="stroke-width: 2;"/><g class="actor"><rect x="1910.28125" y="47.5" width="96.796875" height="37.5" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="1920.28125" y="71.65625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1920.28125">Singpass</tspan></text></g><g class="actor"><rect x="1910.28125" y="919.90625" width="96.796875" height="37.5" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="1920.28125" y="944.0625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1920.28125">Singpass</tspan></text></g><line x1="1958.6796875" x2="1958.6796875" y1="85" y2="919.90625" stroke="#000000" fill="none" style="stroke-width: 2;"/><g class="actor"><rect x="2027.078125" y="47.5" width="77.59375" height="37.5" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="2037.078125" y="71.65625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2037.078125">MyInfo</tspan></text></g><g class="actor"><rect x="2027.078125" y="919.90625" width="77.59375" height="37.5" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="2037.078125" y="944.0625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="2037.078125">MyInfo</tspan></text></g><line x1="2065.875" x2="2065.875" y1="85" y2="919.90625" stroke="#000000" fill="none" style="stroke-width: 2;"/><g class="signal"><text x="515.4765625" y="115.40625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="515.4765625">/login</tspan></text><line x1="53.6015625" x2="1034.9453125" y1="122.5" y2="122.5" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"/></g><g class="note"><rect x="1054.9453125" y="142.5" width="547.671875" height="85.25" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="1059.9453125" y="161.65625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1059.9453125">1. Create a state object</tspan><tspan dy="1.2em" x="1059.9453125">2. Serialize state object to base64 (to put into url)</tspan><tspan dy="1.2em" x="1059.9453125">3. construct a Singpass authorization URL with the state</tspan><tspan dy="1.2em" x="1059.9453125">State is passed back later in redirect_url</tspan></text></g><g class="note"><rect x="73.6015625" y="247.75" width="941.34375" height="85.09375" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="78.6015625" y="266.90625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="78.6015625">query params:</tspan><tspan dy="1.2em" x="78.6015625">- Relying Party client ID</tspan><tspan dy="1.2em" x="78.6015625">- serialized state</tspan><tspan dy="1.2em" x="78.6015625">- redirect url: URL to redirect browser to after user logs in. Must have registered with Singpass</tspan></text></g><g class="signal"><text x="285.0390625" y="363.25" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="285.0390625">&lt;&lt;redirect browser to saml.singpass.gov.sg/authorize&gt;&gt;</tspan></text><line x1="1034.9453125" x2="53.6015625" y1="370.34375" y2="370.34375" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);"/></g><g class="signal"><text x="958.140625" y="400.75" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="958.140625">/authorize</tspan></text><line x1="53.6015625" x2="1958.6796875" y1="407.84375" y2="407.84375" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"/></g><g class="note"><rect x="1131.7578125" y="427.84375" width="806.921875" height="27.640625" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="1136.7578125" y="447" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1136.7578125">user logs in successfully on browser. Singpass now redirect browser to redirect_url</tspan></text></g><g class="signal"><text x="665.2890625" y="485.8203125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="665.2890625">&lt;&lt; redirect browser to redirect_url with query params code and state &gt;&gt;</tspan></text><line x1="1958.6796875" x2="53.6015625" y1="493.125" y2="493.125" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);"/></g><g class="signal"><text x="457.8671875" y="523.53125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="457.8671875">/singpass/callback</tspan></text><line x1="53.6015625" x2="1034.9453125" y1="530.625" y2="530.625" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"/></g><g class="note"><rect x="73.6015625" y="550.625" width="854.921875" height="65.890625" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="78.6015625" y="569.78125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="78.6015625">query params:</tspan><tspan dy="1.2em" x="78.6015625">- authorization code: one-use code to bring to SP's token endpoint to exchange for token</tspan><tspan dy="1.2em" x="78.6015625">- state: state param passed in the /authorize call</tspan></text></g><g class="signal"><text x="1304.7890625" y="646.921875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1304.7890625">/token (with authorization code in body)</tspan></text><line x1="1034.9453125" x2="1958.6796875" y1="654.015625" y2="654.015625" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"/></g><g class="signal"><text x="1453.609375" y="684.421875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1453.609375">JWE Token</tspan></text><line x1="1958.6796875" x2="1034.9453125" y1="691.515625" y2="691.515625" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);"/></g><g class="note"><rect x="1054.9453125" y="711.515625" width="883.734375" height="65.890625" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="1059.9453125" y="730.671875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1059.9453125">1. Decrypt and verify the JWE</tspan><tspan dy="1.2em" x="1059.9453125">2. Get the ID Token, which contains user's NRIC and WOG UUID (UUID maps to NRIC one-to-one)</tspan><tspan dy="1.2em" x="1059.9453125">3. Get MyInfo person data using NRIC</tspan></text></g><g class="signal"><text x="1478.40234375" y="807.8125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1478.40234375">/person/${NRIC}</tspan></text><line x1="1034.9453125" x2="2065.875" y1="814.90625" y2="814.90625" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"/></g><g class="signal"><text x="1420.79296875" y="845.3125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1420.79296875">Person's MyInfo data in JWE</tspan></text><line x1="2065.875" x2="1034.9453125" y1="852.40625" y2="852.40625" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);"/></g><g class="note"><rect x="1054.9453125" y="872.40625" width="326.84375" height="27.5" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="1059.9453125" y="891.5625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="1059.9453125">1. Decrypt JWE to get MyInfo data</tspan></text></g></svg>